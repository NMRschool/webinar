<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Admin — Registros Webinar NMR School</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body{background:#0f1113;color:#e9eef2}
    .card{background:linear-gradient(180deg,#1a2024,#0f1113);border:1px solid #2a2f34;border-radius:14px}
    pre{background:#0b0d0f;color:#dbe5ea;border:1px solid #2a2f34;border-radius:10px;padding:14px;max-height:60vh;overflow:auto}
    a.btn{margin-right:8px}
  </style>
</head>
<body class="py-4">
  <div class="container">
    <div class="d-flex align-items-center justify-content-between mb-3">
      <h1 class="h4 mb-0">Administración — Registros del Webinar</h1>
      <div>
        <a class="btn btn-sm btn-outline-light" href="/nmrschool/registrants.csv">Descargar CSV</a>
        <a class="btn btn-sm btn-outline-info"  href="/nmrschool/registrants">Descargar JSON</a>
        <button id="refresh" class="btn btn-sm btn-primary">Actualizar vista</button>
      </div>
    </div>

    <div class="card">
      <div class="card-body">
        <p class="text-secondary mb-2">Previsualización JSON (<span id="count">0</span> registros):</p>
        <pre id="jsonBox">{}</pre>
        <div class="table-responsive mt-3">
          <table class="table table-dark table-striped table-hover align-middle mb-0" id="tbl">
            <thead>
              <tr>
                <th>Fecha</th><th>Nombre</th><th>Org</th><th>Institución</th><th>Puesto</th><th>Email</th><th>Tel</th><th>+Info</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

<script>
async function loadData(){
  const res = await fetch('/nmrschool/registrants');
  const json = await res.json();
  const box = document.getElementById('jsonBox');
  const count = document.getElementById('count');
  box.textContent = JSON.stringify(json, null, 2);
  count.textContent = json.count ?? (json.data?.length || 0);

  const tbody = document.querySelector('#tbl tbody');
  tbody.innerHTML = '';
  (json.data || []).forEach(r => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${new Date(r.createdAt).toLocaleString()}</td>
      <td>${r.firstName} ${r.lastName}</td>
      <td>${r.orgType||''}</td>
      <td>${r.orgName||''}</td>
      <td>${r.role||''}</td>
      <td>${r.email}</td>
      <td>${r.phone||''}</td>
      <td>${r.moreInfo ? 'Sí' : 'No'}</td>`;
    tbody.appendChild(tr);
  });
}
document.getElementById('refresh').addEventListener('click', loadData);
loadData();
</script>
</body>
</html>
